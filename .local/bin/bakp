#!/bin/sh
#bakp
# mount removable backup media, backup to it and unmount it
# if LABEL=backup drive not mounted, mount it

loaded=$(/usr/bin/findmnt -S LABEL=backup)
#mountpoint=$(/usr/bin/lsblk -l -o +LABEL | /usr/bin/grep backup | /usr/bin/awk '{print $1}') # too much awk!
mountpoint=$(/usr/bin/lsblk -l -o +LABEL | /usr/bin/grep backup | /usr/bin/cut -c -4)

if [ -z "$loaded" ]; then
	/usr/bin/pmount /dev/"$mountpoint" backup && /usr/bin/notify-send "backup started"
fi

# start syncing to backup and back
/usr/bin/rsync --verbose --itemize-changes --archive --checksum -hh --partial --progress --info=stats1 --recursive --modify-window=1 ~/.bak/crypt-bak/ -t /media/backup/ts-bak/bak/crypt-bak && /usr/bin/rsync --verbose --itemize-changes --archive --checksum -hh --partial --progress --info=stats1 --recursive --modify-window=1 /media/backup/ts-bak/bak/crypt-bak/ -t ~/.bak/crypt-bak;
/usr/bin/rsync --verbose --itemize-changes --archive --checksum -hh --partial --progress --info=stats1 --recursive --modify-window=1 ~/.bak/etc-bak/ -t /media/backup/ts-bak/bak/etc-bak && /usr/bin/rsync --verbose --itemize-changes --archive --checksum -hh --partial --progress --info=stats1 --recursive --modify-window=1 /media/backup/ts-bak/bak/etc-bak/ -t ~/.bak/etc-bak;
/usr/bin/rsync --verbose --itemize-changes --archive --checksum -hh --partial --progress --info=stats1 --recursive --modify-window=1 ~/.config/aerc ~/.config/alacritty ~/.config/bash ~/.config/doom ~/.config/dunst ~/.config/gallery-dl ~/.config/gcompris ~/.config/git ~/.config/gtk-2.0 ~/.config/gtk-3.0 ~/.config/mpv ~/.config/newsraft ~/.config/nvim ~/.config/shell ~/.config/X11 ~/.config/xwallpaper ~/.config/youtube-viewer ~/.config/yt-dlp ~/.config/zathura ~/.config/zsh ~/.config/mimeapps.list ~/.config/rmwrc ~/.config/user-dirs.dirs ~/.config/user-dirs.locale -t /media/backup/ts-bak/bak/conf-bak && /usr/bin/rsync --verbose --itemize-changes --archive --checksum -hh --partial --progress --info=stats1 --recursive --modify-window=1 /media/backup/ts-bak/bak/conf-bak/ -t ~/.config;
/usr/bin/rsync --verbose --itemize-changes --archive --checksum -hh --partial --progress --info=stats1 --recursive --modify-window=1 ~/.local/bin/ -t /media/backup/ts-bak/bak/local-bak/bin && /usr/bin/rsync --verbose --itemize-changes --archive --checksum -hh --partial --progress --info=stats1 --recursive --modify-window=1 /media/backup/ts-bak/bak/local-bak/bin/ -t ~/.local/bin;
/usr/bin/rsync --verbose --itemize-changes --archive --checksum -hh --partial --progress --info=stats1 --recursive --modify-window=1 ~/.local/share/bookmarks -t /media/backup/ts-bak/bak/local-bak/share && /usr/bin/rsync --verbose --itemize-changes --archive --checksum -hh --partial --progress --info=stats1 --recursive --modify-window=1 /media/backup/ts-bak/bak/local-bak/share/ -t ~/.local/share;
/usr/bin/rsync --verbose --itemize-changes --archive --checksum -hh --partial --progress --info=stats1 --recursive --modify-window=1 ~/.arx/ -t /media/backup/ts-bak/arx && /usr/bin/rsync --verbose --itemize-changes --archive --checksum -hh --partial --progress --info=stats1 --recursive --modify-window=1 /media/backup/ts-bak/arx/ -t ~/.arx;
/usr/bin/rsync --verbose --itemize-changes --archive --checksum -hh --partial --progress --info=stats1 --recursive --modify-window=1 ~/dox/ -t /media/backup/ts-bak/dox && /usr/bin/rsync --verbose --itemize-changes --archive --checksum -hh --partial --progress --info=stats1 --recursive --modify-window=1 /media/backup/ts-bak/dox/ -t ~/dox;
/usr/bin/rsync --verbose --itemize-changes --archive --checksum -hh --partial --progress --info=stats1 --recursive --modify-window=1 ~/notx/ -t /media/backup/ts-bak/notx && /usr/bin/rsync --verbose --itemize-changes --archive --checksum -hh --partial --progress --info=stats1 --recursive --modify-window=1 /media/backup/ts-bak/notx/ -t ~/notx;
/usr/bin/rsync --verbose --itemize-changes --archive --checksum -hh --partial --progress --info=stats1 --recursive --modify-window=1 ~/nvl/ -t /media/backup/ts-bak/nvl && /usr/bin/rsync --verbose --itemize-changes --archive --checksum -hh --partial --progress --info=stats1 --recursive --modify-window=1 /media/backup/ts-bak/nvl/ -t ~/nvl;
/usr/bin/rsync --verbose --itemize-changes --archive --checksum -hh --partial --progress --info=stats1 --recursive --modify-window=1 ~/rsc/ -t /media/backup/ts-bak/rsc && /usr/bin/rsync --verbose --itemize-changes --archive --checksum -hh --partial --progress --info=stats1 --recursive --modify-window=1 /media/backup/ts-bak/rsc/ -t ~/rsc;
/usr/bin/rsync --verbose --itemize-changes --archive --checksum -hh --partial --progress --info=stats1 --recursive --modify-window=1 ~/sty/ -t /media/backup/ts-bak/sty && /usr/bin/rsync --verbose --itemize-changes --archive --checksum -hh --partial --progress --info=stats1 --recursive --modify-window=1 /media/backup/ts-bak/sty/ -t ~/sty;
/usr/bin/rsync --verbose --itemize-changes --archive --checksum -hh --partial --progress --info=stats1 --recursive --modify-window=1 ~/wfu/ -t /media/backup/ts-bak/wfu && /usr/bin/rsync --verbose --itemize-changes --archive --checksum -hh --partial --progress --info=stats1 --recursive --modify-window=1 /media/backup/ts-bak/wfu/ -t ~/wfu;
/usr/bin/notify-send "backup complete"

# unmount backup drive
/usr/bin/pumount /dev/"$mountpoint"
/usr/bin/notify-send "backup drive unmounted"
